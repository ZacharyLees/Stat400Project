---
title: "Stat400Project"
author: "JamesTondt, Zach Lees, Kyler"
date: "2023-11-29"
output: html_document
---

## Front Matter

```{r}
#Libraries
library(tidyverse)
library(readr)
library(dplyr)

#Import Data
#C:/Users/20lee/Downloads/application_data.csv/application_data.csv
Credit_card_fraud <- read_csv("C:/Users/20lee/Downloads/application_data.csv/application_data.csv")

```

#Research Data Information

Use data from:

https://www.kaggle.com/datasets/mishra5001/credit-card/data?select=application_data.csv 

https://www.kaggle.com/datasets/mishra5001/credit-card/data?select=columns_description.csv 

The data presented provides information about a client with potential credit fraud. The file
includes 122 variables that are a mix of binomial and categorical. The data provided is found on
kaggle by Mishra5001 and was updated 4 years ago.

Response: TARGET(binary)

Predictors: CODE_GENDER(binary), AMT_INCOME_TOTAL(quantitative), AMT_CREDIT(quantitative), NAME_CLIENT_TYPE(binary)

Descriptions:
TARGET: client with reported payment difficulties (this variable will represent credit fraud if
positive)

CODE_GENDER: Gender of the client

AMT_INCOME_TOTAL: Income of the client

AMT_CREDIT: Credit amount of the loan

NAME_CLIENT_TYPE: Was the client old or new when applying for the previous application

Research Question: Are females at a higher risk of credit fraud?/Does Gender have an effect on
the likelihood of credit fraud



# Research Question Data Analysis
Are females at a higher risk of defaulting on loans? Does Gender have an effect on the likelihood of credit default when controlling for their total income, credit loans, and client status for credit applications.


```{r}
# Create a new data frame and clean data
CCF2 <- 
  Credit_card_fraud %>%
  select(TARGET, CODE_GENDER, AMT_INCOME_TOTAL, AMT_CREDIT, NAME_INCOME_TYPE, NAME_EDUCATION_TYPE, NAME_FAMILY_STATUS, NAME_HOUSING_TYPE) %>%
    filter(CODE_GENDER != "XNA") %>%    # only using M and F
    na.omit(CCF2)   # remove any missing values

# create indicator variable for GENDER and TARGET
CCF2 <- CCF2 %>%
  mutate(is_female = ifelse(CODE_GENDER == "F", 1, 0), TargetYes = ifelse(TARGET == 1,"Yes","No"))

```

```{r}
str(CCF2)
```

```{r}
summary(CCF2)
```
# Univariate Analysis and Multivairate Analysis

Target is our response variable, this is whether the client was reported to have payment difficulties. For study purposes TargetYes will determine if the client is determined to have credit fraud (yes) or not (no).

Based upon a quick analysis of this graph, most of the data collected shows that TargetYes does not hold the vast majority of responses shown for credit fraud detection. This means that most of the clients, based upon the data, collected may not be subject to credit fraud and that we can continue our analysis further to see if Target will be a good response variable to our research question.

```{r}
# Barplot for Credit Fraud distribution
ggplot(CCF2, aes(x = TargetYes)) +
  geom_bar(fill = "blue") +
  labs(title = "Distribution of Whether they Defaulted or Not",
       x = "Reported Defaults",
       y = "Count") +
  theme_minimal()

```



Continuing on with our research, we created a graph that shows the distribution of Gender  (male or female) to observe the split between genders collected and reported defaults.

Based upon the graph above we can say that about twice the amount of clients reported to be females verses males had no reported defaults. However, from further observation, we can see that females have a slightly higher count than males for reported defaults. Continuing forward in our data analysis we will observe other relationships between the variables.

```{r}
# Barplot for Gender distribution
ggplot(CCF2, aes(x = CODE_GENDER, fill = CODE_GENDER)) +
  geom_bar() +
  facet_wrap(vars(TargetYes))+
  labs(title = "Distribution of Gender",
       x = "Gender",
       y = "Count",
       color = "Gender") +
  theme_minimal()

```


Next we will oserve the relationship between total income and gender. Due to an error in the graph, there may be an incorrectly entered point. Removing any data exceeding an income of 1,000,000 would keep our data from having errors or excessive outliers. We will set a maximum income value of 1,000,000 to clean our data.

Looking at the data comparing total income and the amount of defaults reported by gender, we can see that females typically show a pattern to have more reported defaults than the males do with the same to similar total incomes. Looking at this graph we have to keep in mind that more females than males were also surveyed, so this graph alone is not enough to provide enough evidence to support our research statement.
```{r}
# Histogram for Total Income
ggplot(CCF2, aes(x = AMT_INCOME_TOTAL, fill = CODE_GENDER)) +
  geom_histogram(binwidth = 40000) +
  facet_wrap(vars(TargetYes))+
  labs(title = "Distribution of Total Income",
       x = "Total Income",
       y = "Count",
       color = "Gender") +
  coord_cartesian(xlim = c(0, 1000000))
# Remove income past 1,000,000
CCF2 <- CCF2 %>% filter(AMT_INCOME_TOTAL < 1000000)
```


Comparing the graphs for Total Income and Credit amount, the graphs seem to be very similar. Thus it is fair to consider the fact that the credit amount of a loan is dependent on the house income and based upon the data is closely related to the same amount.
```{r}
# Histogram for Credit Amount
ggplot(CCF2, aes(x = AMT_CREDIT)) +
  geom_histogram(binwidth = 100000, fill = "orange", color = "black") +
  labs(title = "Distribution of Credit Amount",
       x = "Credit Amount",
       y = "Count") +
  theme_minimal()

```


For a categorical and quantitative variable, we want to create side-by-side boxplots and look at summary statistics.

Interestingly we have found that males have higher income on average in each respective quarterly. Income doesn't appear to be a very strong predictor for determining if a client defaulted or not.
```{r}

# Scatterplot for Credit Fraud by Total Income
ggplot(CCF2, aes(x = TargetYes, y = AMT_INCOME_TOTAL, color = CODE_GENDER)) +
  geom_boxplot() +
  labs(title = "Credit Fraud by Total Income",
       y = "Total Income",
       x = "Credit Fraud Depiction",
       color = "Gender")
```


```{r}
CCF2 %>% 
  group_by(TargetYes) %>%
  summarize(meanMath = mean(AMT_INCOME_TOTAL),
            medianMath = median(AMT_INCOME_TOTAL),
            sdMath = sd(AMT_INCOME_TOTAL), count = n())
```

The boxplots between male and female regarding if they have reported default or not in the data don't appear to be very different for credit amount. Credit amount may not be a strong predictor for determining if a client defaulted or not. This could be because the credit amount given is not sex dependent, so males and females recieve credit on the same rate based upon thier income.
```{r}
# Scatterplot for Credit Fraud by Credit Amount
ggplot(CCF2, aes(x = TargetYes, y = AMT_CREDIT, color = CODE_GENDER)) +
  geom_boxplot() +
  labs(title = "Credit Fraud by Credit Amount",
       y = "Credit Amount",
       x = "Credit Fraud Depiction",
       color = "Gender") +
  theme_minimal()
```


```{r}
CCF2 %>% 
  group_by(TargetYes) %>%
  summarize(meanMath = mean(AMT_CREDIT),
            medianMath = median(AMT_CREDIT),
            sdMath = sd(AMT_CREDIT))
```


Next we create a graph to show the relation between credit fraud and income type.

Based upon the graph we can consider that there is a relationship between income type and default. 
```{r}
# Barplot for Credit Fraud by Client Status
ggplot(CCF2, aes(x = NAME_INCOME_TYPE, fill = factor(TargetYes))) +
  geom_bar(position = "dodge") +
  labs(title = "Defaults by Client Status for Credit Applications",
       x = "Client Status",
       y = "Count",
       fill = "Defaulted") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```


For further analysis we will create a a model and test the variables' correlations to TargetYes and form a conclusion to our research question: Are females at a higher risk of credit fraud?/Does Gender have an effect on the likelihood of credit fraud when controlling for their total income, credit loans, and client status for credit applications.